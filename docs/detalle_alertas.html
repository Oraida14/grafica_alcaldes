<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Detalles de Alertas - Tanque Alcaldes</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body {
      background-color: #121212;
      color: #e0e0e0;
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
    }
    .card {
      width: 100%;
      background: linear-gradient(145deg, #2c3e50, #34495e);
      border-radius: 15px;
      margin-bottom: 20px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
      transition: transform 0.3s, box-shadow 0.3s;
      box-sizing: border-box;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
    }
    h1, h4, h5 {
      color: #ecf0f1;
    }
    .alert {
      padding: 15px;
      margin-bottom: 20px;
      border: 1px solid transparent;
      border-radius: 4px;
    }
    .alert-danger {
      color: #a94442;
      background-color: #f2dede;
      border-color: #ebccd1;
    }
    table {
      color: #e0e0e0;
      width: 100%;
      margin-bottom: 20px;
    }
    table th, table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    table th {
      background-color: #2c3e50;
    }
    .navbar {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <!-- 游댳 Navbar corregido -->
<!-- 游댳 Navbar corregido -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="index.html">Tanque Alcaldes</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="index.html">An치lisis General</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reporte.html">Reporte</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="seguridad.html">Seguridad</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="analisis.html">An치lisis</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="detalle_alertas.html">Detalle Alertas</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<script>
  // 游댳 Resaltar pesta침a activa seg칰n la URL
  const currentPage = window.location.pathname.split("/").pop(); // obtiene index.html, reporte.html, etc.
  const navLinks = document.querySelectorAll('.navbar-nav .nav-link');

  navLinks.forEach(link => {
    if (link.getAttribute('href') === currentPage) {
      link.classList.add('active');
    } else {
      link.classList.remove('active');
    }
  });
</script>


  </nav>
  <h1 class="text-center mb-4">Detalles de Alertas - Tanque Alcaldes</h1>
  <div class="card">
    <h4 class="text-center">Eventos Significativos</h4>
    <table id="eventosTable">
      <thead>
        <tr>
          <th>Fecha/Hora</th>
          <th>Cambio en Nivel (m)</th>
          <th>Duraci칩n (min)</th>
          <th>Descripci칩n</th>
        </tr>
      </thead>
      <tbody>
        <!-- Los datos se cargar치n din치micamente -->
      </tbody>
    </table>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    async function fetchAlertas() {
      const reporteUrl = 'https://raw.githubusercontent.com/Oraida14/grafica_alcaldes/master/reporte_tanque.json';
      const csvUrl = 'https://raw.githubusercontent.com/Oraida14/grafica_alcaldes/master/static/tanque_alcaldes.csv';

      // Cargar datos CSV
      const response = await fetch(csvUrl);
      const csvText = await response.text();
      const results = Papa.parse(csvText, {
        header: true,
        dynamicTyping: true,
      });
      const data = results.data;

      // Cargar reporte JSON
      const reporteResponse = await fetch(reporteUrl);
      const reporte = await reporteResponse.json();

      // Obtener eventos significativos
      const eventosSignificativos = detectarEventosSignificativos(data);

      // Mostrar eventos significativos en la tabla
      const eventosTable = document.getElementById('eventosTable').getElementsByTagName('tbody')[0];
      eventosSignificativos.forEach(evento => {
        const row = eventosTable.insertRow();
        row.insertCell(0).textContent = evento.fechaHora;
        row.insertCell(1).textContent = evento.cambioNivel;
        row.insertCell(2).textContent = evento.duracion;
        row.insertCell(3).textContent = evento.descripcion;
      });
    }

    function detectarEventosSignificativos(data) {
      const eventos = [];
      let prevNivel = data[0].Nivel_1;
      let prevFechaHora = new Date(data[0].fecha_hora);

      for (let i = 1; i < data.length; i++) {
        const nivelActual = data[i].Nivel_1;
        const fechaHoraActual = new Date(data[i].fecha_hora);
        const cambioNivel = Math.abs(nivelActual - prevNivel);
        const duracion = (fechaHoraActual - prevFechaHora) / (1000 * 60); // Duraci칩n en minutos

        if (cambioNivel > 0.1 && duracion <= 60) { // Cambio significativo en menos de 60 minutos
          eventos.push({
            fechaHora: fechaHoraActual.toLocaleString(),
            cambioNivel: cambioNivel.toFixed(2),
            duracion: duracion.toFixed(2),
            descripcion: `Cambio significativo de ${cambioNivel.toFixed(2)} m en ${duracion.toFixed(2)} minutos`
          });
        }

        prevNivel = nivelActual;
        prevFechaHora = fechaHoraActual;
      }

      return eventos;
    }

    fetchAlertas();
  </script>
</body>
</html>
